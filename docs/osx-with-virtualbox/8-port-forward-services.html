<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title> | Navy</title>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://moneyhub.github.io/navy/styles.css" />
  </head>
  <body>
    <div id="sidebar">
      <div id="logo">Na<span>v</span>y</div>

      <ul class="side-nav">
        <li>
          <a href="https://moneyhub.github.io/navy/">Home</a>
        </li>
      </ul>

      
      <h4>Usage</h4>

      <ul class="side-nav">
        <li>
          <a href="https://moneyhub.github.io/navy/docs/getting-started/1-intro.html">Getting started</a>
        </li>
        <li>
          <a href="https://moneyhub.github.io/navy/docs/getting-started/2-day-to-day-usage.html">Day-to-day usage</a>
        </li>
        <li>
          <a href="https://moneyhub.github.io/navy/docs/getting-started/3-develop.html">Developing services</a>
        </li>
        <li>
          <a href="https://moneyhub.github.io/navy/docs/getting-started/4-multiple-navies.html">Working with Multiple Navies</a>
        </li>
      </ul>

      <h4>Advanced</h4>

      <ul class="side-nav">
        <li>
          <a href="https://moneyhub.github.io/navy/docs/api-introduction.html">Node API tutorial</a>
        </li>
        <li>
          <a href="https://moneyhub.github.io/navy/docs/writing-plugins.html">Writing plugins</a>
        </li>
        <li>
          <a href="https://moneyhub.github.io/navy/docs/http-proxy.html">HTTP proxy</a>
        </li>
      </ul>

      <h4>Reference</h4>

      <ul class="side-nav">
        <li>
          <a href="https://moneyhub.github.io/navy/docs/navyfile-config.html">Navyfile.js config</a>
        </li>
        <li>
          <a href="https://moneyhub.github.io/navy/docs/api/">API Documentation</a>
        </li>
      </ul>
      

      <div class="side-links">
        <a href="https://github.com/moneyhub/navy" target="_blank" class="link-with-image">
          <img src="https://moneyhub.github.io/navy/github-logo.png" width="32">
          View on GitHub
        </a>
      </div>
    </div>

    <div id="page">
      <h1 id="portforwardeachactivenavyservicetoyourvirtialboxdockermachine">Port forward each active Navy service to your VirtialBox docker-machine</h1>
<p>The final step is to port-forward each external port used for each active service to your docker-machine running on VirtualBox.</p>
<p>The complication here is that Navy at the moment will only return each services external port if your know both the service name and it's internal port. To simplify this process you can use the following bash script which essentially reads the output of <code>$ navy ps</code> and port-forwards each active service to your docker-machine on VirtualBox.</p>
<p>Copy the following :</p>
<pre><code>IFS=' '
output=$(navy ps)
while read -r line; do
  running=$(echo $line | awk '{ print $4 }');
  if test "$running" = "running"; then
    service=$(echo $line | awk '{ print $2 }');
    internal=$(echo $line | grep -o -- '-&gt;[0-9]\+/tcp' | grep -o '[0-9]\+');
    external=$(navy port "$service" "$internal");
    VBoxManage controlvm "default" natpf1 delete "${service}"&gt;/dev/null 2&gt;&amp;1
    VBoxManage controlvm "default" natpf1 "${service},tcp,,${external},,${external}"&gt;/dev/null 2&gt;&amp;1
    echo "Adding port forwarding for: \`${service}\` from \`${internal}\` to \`${external}\`"
  fi
done &lt;&lt;&lt; "$output"
</code></pre>
<p>Save this script to a file e.g. map-navy-ports.sh and execute that file from the command line</p>
<pre><code>$ map-navy-ports.sh
</code></pre>
<p>You can check that this has worked by going to yout VirtualBix GUI for your docker-machine, right click and select settings &gt; Network &gt; Advanced &gt; Port Forwarding</p>
<p>You should then see a list of each service with it's external port mapped.</p>
    </div>
  </body>
</html>
